<!DOCTYPE html>  <html> <head>   <title>syntax.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="intro.html">                 intro.js               </a>                                           <a class="source" href="syntax.html">                 syntax.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               syntax.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>guard :: Contract x any x String x String</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>functions: simple</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">fun</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Bool</span><span class="p">)</span><span class="o">,</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span> <span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>multiple args</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">fun</span><span class="p">([</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Bool</span><span class="p">]</span><span class="o">,</span> <span class="nx">Bool</span><span class="p">)</span><span class="o">,</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="o">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span> <span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>optional args </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">fun</span><span class="p">([</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">opt</span><span class="p">(</span><span class="nx">Bool</span><span class="p">)</span><span class="o">,</span> <span class="nx">opt</span><span class="p">(</span><span class="nx">Str</span><span class="p">)]</span><span class="o">,</span> <span class="nx">Bool</span><span class="p">)</span><span class="o">,</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="o">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* ... */</span> <span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>optional args, bad form</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">fun</span><span class="p">([</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">opt</span><span class="p">(</span><span class="nx">Bool</span><span class="p">)</span><span class="o">,</span> <span class="nx">opt</span><span class="p">(</span><span class="nx">Str</span><span class="p">)</span><span class="o">,</span> <span class="nx">Num</span><span class="p">]</span><span class="o">,</span> <span class="nx">Bool</span><span class="p">)</span><span class="o">,</span> <span class="c">// fail, can&#39;t have non-optional after optional</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="o">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* ... */</span> <span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>higher-order</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">fun</span><span class="p">(</span><span class="nx">fun</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Bool</span><span class="p">)</span><span class="o">,</span> <span class="nx">Str</span><span class="p">)</span><span class="o">,</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="o">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* ... */</span> <span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>dependent</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">fun</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">check</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">arg</span> <span class="o">===</span> <span class="nx">r</span><span class="o">;</span> <span class="p">});</span> <span class="p">})</span><span class="o">,</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span><span class="o">;</span> <span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>constructor only</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">ctor</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">object</span><span class="p">({</span><span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">Num</span><span class="p">}))</span><span class="o">,</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">s</span><span class="o">;</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="mi">42</span><span class="o">;</span> <span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>desugars to </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">functionContract</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">object</span><span class="p">({</span><span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">Num</span><span class="p">})</span><span class="o">,</span>
                     <span class="p">{</span> <span class="nx">newOnly</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span><span class="o">,</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">s</span><span class="o">;</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="mi">42</span><span class="o">;</span> <span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>call only</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">funCall</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Bool</span><span class="p">)</span><span class="o">,</span> <span class="c">// funNN? funNoNew? funCO? default behavior for fun? no convenience form?</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* ... */</span> <span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>so .newOnly(true).callOnly(true) -> throw exception
desugars to</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">functionContract</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Bool</span><span class="o">,</span> <span class="p">{</span> <span class="nx">callOnly</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span><span class="o">,</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* ... */</span> <span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>lazy new constructor</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">ctorSafe</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">object</span><span class="p">({</span><span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">Num</span><span class="p">}))</span><span class="o">,</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">s</span><span class="o">;</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="mi">42</span><span class="o">;</span> <span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>will automatically create the right new:
new f(..) works normally
f(..) will create the appropriate "this" and apply it to f
desugars to</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">functionContract</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">object</span><span class="p">({</span><span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">Num</span><span class="p">})</span><span class="o">,</span> <span class="p">{</span> <span class="nx">safeNew</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span><span class="o">,</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">s</span><span class="o">;</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="mi">42</span><span class="o">;</span> <span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>different contract for call and new</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">ctor</span><span class="p">({</span>
         <span class="nx">call</span><span class="o">:</span> <span class="p">[</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Bool</span><span class="p">]</span><span class="o">,</span>
         <span class="k">new</span> <span class="o">:</span> <span class="p">[[</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Num</span><span class="p">]</span><span class="o">,</span> <span class="nx">object</span><span class="p">({</span><span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">Num</span><span class="p">})]</span>
     <span class="p">})</span><span class="o">,</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* ... */</span> <span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>explicit contract on this</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">fun</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Bool</span><span class="o">,</span>
         <span class="p">{</span> <span class="k">this</span><span class="o">:</span> <span class="nx">object</span><span class="p">({</span> <span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">Num</span> <span class="p">})}</span>
        <span class="p">)</span><span class="o">,</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span><span class="o">;</span> <span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>lazy vs strict checking of object properties?
what about .onlyNew(true).thisContract({a: Str})? throw exception?</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>objects: data obj</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">object</span><span class="p">({</span>
          <span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span>
          <span class="nx">b</span><span class="o">:</span> <span class="nx">Bool</span>
     <span class="p">})</span><span class="o">,</span>
     <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="nx">b</span><span class="o">:</span> <span class="kc">false</span><span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>nested data objects
eager vs lazy checking?</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">object</span><span class="p">({</span>
          <span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span>
          <span class="nx">b</span><span class="o">:</span> <span class="nx">object</span><span class="p">({</span>
               <span class="nx">c</span><span class="o">:</span> <span class="nx">Bool</span><span class="o">,</span>
               <span class="nx">d</span><span class="o">:</span> <span class="nx">Num</span>
          <span class="p">})</span>
     <span class="p">})</span><span class="o">,</span>
     <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="nx">b</span><span class="o">:</span> <span class="p">{</span><span class="nx">c</span><span class="o">:</span> <span class="kc">false</span><span class="o">,</span> <span class="nx">d</span><span class="o">:</span> <span class="mi">42</span><span class="p">}}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>forzen </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">object</span><span class="p">({</span>
          <span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span>
          <span class="nx">b</span><span class="o">:</span> <span class="nx">Num</span>
     <span class="p">}</span><span class="o">,</span> <span class="p">{</span> <span class="nx">freeze</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span><span class="o">,</span> 
     <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">42</span><span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span>     </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>optional properties</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
    <span class="nx">object</span><span class="p">({</span>
        <span class="nx">a</span><span class="o">:</span> <span class="nx">opt</span><span class="p">(</span><span class="nx">Str</span><span class="p">)</span><span class="o">,</span>
        <span class="nx">b</span><span class="o">:</span> <span class="nx">Num</span>
    <span class="p">})</span><span class="o">,</span>
    <span class="p">{</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">42</span> <span class="p">}</span><span class="o">,</span>
    <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>immutable properties</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">object</span><span class="p">({</span>
          <span class="nx">a</span><span class="o">:</span> <span class="p">[</span><span class="nx">Str</span><span class="o">,</span> <span class="p">{</span><span class="nx">immutable</span><span class="o">:</span> <span class="kc">true</span><span class="p">}]</span><span class="o">,</span>
          <span class="nx">b</span><span class="o">:</span> <span class="nx">Num</span>
     <span class="p">})</span><span class="o">,</span> 
     <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">42</span><span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span>     </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>recursive</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">a</span> <span class="o">:</span> <span class="s2">&quot;hi&quot;</span><span class="o">,</span> <span class="nx">b</span><span class="o">:</span> <span class="kc">null</span><span class="p">}</span>
<span class="nx">o</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">o</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>or</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="nx">rec</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{</span> <span class="nx">a</span> <span class="o">:</span> <span class="s2">&quot;hi&quot;</span><span class="o">,</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">o</span><span class="p">};</span> <span class="p">});</span>
<span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">object</span><span class="p">({</span>
         <span class="nx">a</span><span class="o">:</span> <span class="nx">Num</span><span class="o">,</span>
         <span class="nx">b</span><span class="o">:</span> <span class="nx">self</span><span class="o">,</span>
         <span class="nx">c</span><span class="o">:</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">Num</span><span class="o">,</span> <span class="nx">self</span><span class="p">)</span><span class="o">,</span>
         <span class="nx">d</span><span class="o">:</span> <span class="nx">object</span><span class="p">({</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span> <span class="nx">z</span><span class="o">:</span> <span class="nx">self</span> <span class="p">})</span> <span class="c">// this self is not the same as the others!</span>
     <span class="p">})</span><span class="o">,</span>
     <span class="nx">o</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>object with simple method</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">object</span><span class="p">({</span>
          <span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span>
          <span class="nx">m</span><span class="o">:</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Bool</span><span class="p">)</span>
     <span class="p">})</span><span class="o">,</span>
     <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="nx">m</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* ... */</span> <span class="p">}}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>implicit this contract? "desugars" to:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">object</span><span class="p">({</span>
          <span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span>
          <span class="nx">m</span><span class="o">:</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Bool</span><span class="o">,</span> <span class="p">{</span>
              <span class="k">this</span> <span class="o">:</span> <span class="nx">object</span><span class="p">({</span><span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span> <span class="nx">m</span><span class="o">:</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Bool</span><span class="p">).</span><span class="nx">thisContract</span><span class="p">(...)})</span>
          <span class="p">})</span>
     <span class="p">})</span><span class="o">,</span>
     <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="nx">m</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* ... */</span> <span class="p">}}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>if object contract checking of this is eager then we could have 
a problem...module pattern where methods are really functions that don't refer to this
should be fine with lazy checking though? if function never uses this, checking never happens.
what if we had a function that used this in a generic way? wouldn't want any contract so be explicit about
there not being a contract? .thisContract({})
a little non-obvious but this seems like a rare pattern so probably fine?</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>object with simple method explicit about this contract</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">object</span><span class="p">({</span>
          <span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span>
          <span class="nx">m</span><span class="o">:</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Bool</span><span class="o">,</span> <span class="p">{</span> <span class="k">this</span><span class="o">:</span> <span class="nx">object</span><span class="p">({</span><span class="nx">c</span><span class="o">:</span> <span class="nx">Bool</span><span class="o">,</span> <span class="nx">d</span><span class="o">:</span> <span class="nx">Str</span><span class="p">})})</span>
     <span class="p">})</span><span class="o">,</span>
     <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="nx">m</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">d</span><span class="o">;</span> <span class="p">}}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>overrides the implicit this contract on methods</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>object with method that has pre/post conditions</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">object</span><span class="p">({</span>
          <span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span>
          <span class="nx">m</span><span class="o">:</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Bool</span><span class="o">,</span> <span class="p">{</span>
              <span class="nx">pre</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">a</span> <span class="o">===</span> <span class="s2">&quot;foo&quot;</span><span class="o">;</span> <span class="p">}</span><span class="o">,</span> <span class="c">// obj is a ref to the calling object (could be this?)</span>
              <span class="nx">post</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">a</span> <span class="o">===</span> <span class="s2">&quot;foo&quot;</span><span class="o">;</span> <span class="p">}</span>
          <span class="p">})</span>
     <span class="p">})</span><span class="o">,</span>
     <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="nx">m</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* ... */</span> <span class="p">}}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>prototype</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">object</span><span class="p">({</span>
          <span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span>
          <span class="nx">b</span><span class="o">:</span> <span class="nx">Num</span>
     <span class="p">})</span><span class="o">,</span>
     <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">42</span><span class="p">}</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">op</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">p</span><span class="o">,</span> <span class="p">{</span><span class="nx">c</span><span class="o">:</span> <span class="kc">false</span><span class="o">,</span> <span class="nx">d</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}})</span>
<span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">object</span><span class="p">({</span>
          <span class="nx">c</span><span class="o">:</span> <span class="nx">Bool</span><span class="o">,</span>
          <span class="nx">d</span><span class="o">:</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Bool</span><span class="p">)</span>
     <span class="p">})</span><span class="o">,</span>
     <span class="nx">op</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>anything weird going on here? blame goes to proto if failing proto contract.
blame falls on op if fails op contract. all should be fine right?          </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>maybe we want ability to distinguish between object and proxy in one swoop?</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">op</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="nx">a</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">42</span><span class="p">}</span><span class="o">,</span> <span class="p">{</span><span class="nx">c</span><span class="o">:</span> <span class="kc">false</span><span class="o">,</span> <span class="nx">d</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}})</span>
<span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">object</span><span class="p">({</span>
          <span class="nx">c</span><span class="o">:</span> <span class="nx">Bool</span><span class="o">,</span>
          <span class="nx">d</span><span class="o">:</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Bool</span><span class="p">)</span>
     <span class="p">}</span><span class="o">,</span> <span class="p">{</span>
         <span class="nx">proto</span><span class="o">:</span> <span class="nx">object</span><span class="p">({</span>     <span class="c">// this would be anywhere on the prototype chain (aka anything not ownProperty)</span>
          <span class="nx">a</span><span class="o">:</span> <span class="nx">Str</span><span class="o">,</span>
          <span class="nx">b</span><span class="o">:</span> <span class="nx">Num</span>
         <span class="p">})}</span>
     <span class="p">)</span><span class="o">,</span>
     <span class="nx">op</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>does this really give us anything over the previous form?</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>List</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">List</span><span class="o">,</span>
     <span class="p">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="p">]</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>desugars to</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">object</span><span class="p">({}</span><span class="o">,</span> <span class="p">{</span>
         <span class="nx">frozen</span><span class="o">:</span> <span class="kc">true</span><span class="o">,</span>
         <span class="nx">noDelete</span><span class="o">:</span> <span class="kc">true</span><span class="o">,</span>
         <span class="nx">init</span><span class="o">:</span> <span class="p">[</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="o">,</span> <span class="nx">hasNoHoles</span><span class="p">]</span>
     <span class="p">})</span><span class="o">,</span>
     <span class="p">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="p">]</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>SaneArray</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">SaneArray</span><span class="o">,</span>
     <span class="p">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="p">]</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>desugars to</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">object</span><span class="p">({}</span><span class="o">,</span> <span class="p">{</span>
          <span class="nx">frozen</span> <span class="o">:</span> <span class="kc">false</span><span class="o">,</span>
          <span class="nx">noDelete</span><span class="o">:</span> <span class="kc">true</span><span class="o">,</span> <span class="c">// does this make sense? maybe only noDelete for indexes?</span>
          <span class="nx">init</span> <span class="o">:</span> <span class="p">[</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="o">,</span> <span class="nx">hasNoHoles</span><span class="p">]</span>
     <span class="p">})</span><span class="o">,</span>
     <span class="p">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="p">]</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>array</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nb">Array</span><span class="o">,</span>
     <span class="p">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="p">]</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>desugars to</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
     <span class="nx">object</span><span class="p">({}</span><span class="o">,</span> <span class="p">{</span>
          <span class="nx">frozen</span> <span class="o">:</span> <span class="kc">false</span><span class="o">,</span>
          <span class="nx">noDelete</span> <span class="o">:</span> <span class="kc">false</span><span class="o">,</span>
          <span class="nx">init</span> <span class="o">:</span> <span class="p">[</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">]</span>
     <span class="p">})</span><span class="o">,</span>
     <span class="p">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="p">]</span><span class="o">,</span>
     <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>arr is the structural version of array checking</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
    <span class="nx">arr</span><span class="p">([</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">Bool</span><span class="p">])</span><span class="o">,</span> <span class="c">// or arr(Str, Bool)?</span>
    <span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="p">]</span><span class="o">,</span>
    <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span>
<span class="p">);</span>

<span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
    <span class="nx">arr</span><span class="p">([</span><span class="nx">___</span><span class="p">(</span><span class="nx">Num</span><span class="p">)])</span><span class="o">,</span>
    <span class="p">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="p">]</span><span class="o">,</span>
    <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span>
<span class="p">);</span>

<span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
    <span class="nx">arr</span><span class="p">([</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">___</span><span class="p">(</span><span class="nx">Num</span><span class="p">)])</span><span class="o">,</span>
    <span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="p">]</span><span class="o">,</span>
    <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span>
<span class="p">);</span>

<span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
    <span class="nx">arr</span><span class="p">([</span><span class="nx">Str</span><span class="o">,</span> <span class="nx">___</span><span class="p">(</span><span class="nx">Num</span><span class="p">)</span><span class="o">,</span> <span class="nx">Bool</span><span class="p">])</span><span class="o">,</span>
    <span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span> <span class="kc">false</span><span class="p">]</span><span class="o">,</span>
    <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span>
<span class="p">);</span>

<span class="k">return</span> <span class="nx">guard</span><span class="p">(</span>
    <span class="nx">arr</span><span class="p">([</span><span class="nx">_</span><span class="o">,</span> <span class="nx">___</span><span class="p">(</span><span class="nx">Num</span><span class="p">)])</span><span class="o">,</span> <span class="c">// single underscore aliased to Any?</span>
    <span class="p">[</span><span class="kc">false</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="p">]</span><span class="o">,</span>
    <span class="nx">server</span><span class="o">,</span> <span class="nx">client</span>
<span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 